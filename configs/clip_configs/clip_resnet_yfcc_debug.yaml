_BASE_: "../Base-RCNN-C4.yaml"
MODEL:
  META_ARCHITECTURE: "PretrainFastRCNN" # "CLIPFastRCNN" # "CLIPRCNN" # "GeneralizedRCNN"
  BACKBONE:
    NAME: "build_clip_resnet_backbone" # "build_resnet_fpn_backbone"
    FREEZE_AT: 0 # 2
  WEIGHTS: "" # "detectron2://ImageNetPretrained/MSRA/R-50.pkl"
  MASK_ON: False
  RESNETS:
    DEPTH: 50
    OUT_FEATURES: ["res4"]
    NORM: FrozenBN
    STEM_OUT_CHANNELS: 64
    RES2_OUT_CHANNELS: 256
  ROI_HEADS:
    NAME: "PretrainRes5ROIHeads" # "CLIPRes5ROIHeads" # "Res5ROIHeads" # "StandardROIHeads"
    IN_FEATURES: ["res4"]
  PIXEL_MEAN: [0.48145466, 0.4578275, 0.40821073]
  PIXEL_STD: [0.26862954, 0.26130258, 0.27577711]
  CLIP:
    CLSS_TEMP: 10.0 # Typical good values are 100.0 for euclidean, 10.0 for dot, 0.01 for cosine
    PRETRAIN_RPN_REGIONS: 100
    PRETRAIN_SAMPLE_REGIONS: 100
INPUT:
  MIN_SIZE_TRAIN: (640, 672, 704, 736, 768, 800)
DATASETS:
  TRAIN: ("yfcc100m",)
  FACTORY_TRAIN: ("CLIPImgTxtPairTSVDataset",)
  PATH_TRAIN: ("/home/v-yiwuzhong/projects/azureblobs/vlpdatasets/coco-caption/val2017",) # ("/home/v-yiwuzhong/projects/azureblobs/vlpdatasets/CC3M-filtered/0/images.tsv",) # ("/home/v-yiwuzhong/projects/azureblobs/vlpdatasets/yfcc100m/val",)
  TEST: () 
  # TEST: ("yfcc100m",) # () # ("imagenet",)
  # FACTORY_TEST: ("CLIPImgTxtPairTSVDataset",) # ("CLIPImgTSVDataset",)
  # PATH_TEST: ("/home/v-yiwuzhong/projects/azureblobs/vlpdatasets/flickr30k_entities_tsv/entities_test",) # ("/home/v-yiwuzhong/projects/azureblobs/vlpdatasets/imagenet-tsv/val.tsv",)
DATALOADER:
  ASPECT_RATIO_GROUPING: False
TEST:
  DETECTIONS_PER_IMAGE: 300  # LVIS allows up to 300
  EVAL_PERIOD: 2500000
SOLVER: # refer to cvpr ovr
  IMS_PER_BATCH: 64 # 8 gpu
  BASE_LR: 0.01
  WEIGHT_DECAY: 0.0001
  STEPS: (20000, 35000)
  MAX_ITER: 40000
  CLIP_GRADIENTS:
    ENABLED: True
    CLIP_TYPE: "norm"
    CLIP_VALUE: 5.0
INPUT:
  MIN_SIZE_TRAIN_SAMPLING: choice
  MIN_SIZE_TRAIN: (640, 672, 704, 736, 768, 800)
  MAX_SIZE_TRAIN: 1333
  MIN_SIZE_TEST: 800
  MAX_SIZE_TEST: 1333
  FORMAT: "RGB"
AUG: # Data Augmentation from MSR-CLIP 
  TRAIN:
    IMAGE_SIZE: [800,]  # [224, 224]
    MAX_SIZE: 1333
  TEST:
    IMAGE_SIZE: [800,]  # [224, 224]
    MAX_SIZE: 1333
  INTERPOLATION: 3